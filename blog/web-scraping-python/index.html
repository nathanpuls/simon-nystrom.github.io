<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <base href=/ > <link href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/atom-one-dark-reasonable.min.css rel=stylesheet> <link href=global.css rel=stylesheet> <link href=manifest.json rel=manifest crossorigin=use-credentials> <link href=favicon.png rel=icon type=image/png> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,null,{post:{html:"\u003Cp\u003ESometimes you want to access data on the web that isn&#39;t easily available through an API. For that, web scraping is a viable alternative. Web scraping is in essence a way to programmatically visit a web site as if you were a browser and fetch the data that way. This tutorial post will guide you through the process of web scraping using Python3, and two libraries \u003Ca href=\"https:\u002F\u002Fwww.crummy.com\u002Fsoftware\u002FBeautifulSoup\u002Fbs4\u002Fdoc\u002F\"\u003EBeautifulSoup\u003C\u002Fa\u003E and \u003Ca href=\"https:\u002F\u002Frequests.readthedocs.io\u002Fen\u002Fmaster\u002F\"\u003ERequests\u003C\u002Fa\u003E. As an example, we will build a command line application to search and print ratings for movies and TV shows on IMDB.\u003C\u002Fp\u003E\n\u003Chr\u003E\n\u003Ch1 id=\"project-setup\"\u003EProject setup\u003C\u002Fh1\u003E\n\u003Cp\u003ETo follow along with the tutorial you will need to have the following:\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fwww.python.org\u002Fdownloads\u002F\"\u003EPython\u003C\u002Fa\u003E installed\u003C\u002Fli\u003E\n\u003Cli\u003ESome basic knowledge of Python and some basic HTML\u002FCSS knowledge\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003EAlternatively you can check out \u003Ca href=\"https:\u002F\u002Fnewcurrent.se\u002Fblog\u002Fcontainerized-development-environment\"\u003Emy blog post for using dev containers\u003C\u002Fa\u003E and follow that guide but select the \u003Ccode\u003EPython 3\u003C\u002Fcode\u003E container spec when creating the dev container. If you can&#39;t get the dev container way to work, you can refer to the \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fsimon-nystrom\u002Fsimple-web-scrape\"\u003Erepository for this blog post\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003ELet&#39;s begin by creating a folder for our project and installing the required dependencies:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Cdiv class=\"copy-me\" onclick=\"copyCode(this)\"\u003ECopy\u003C\u002Fdiv\u003E\u003Ccode\u003Emkdir web-scrape\n\u003Cspan class=\"hljs-built_in\"\u003Ecd\u003C\u002Fspan\u003E web-scrape\npip3 install beautifulsoup4 requests\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cul\u003E\n\u003Cli\u003E\u003Ccode\u003Ebeautifulsoup4\u003C\u002Fcode\u003E lets us easily access DOM elements programmatically\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003Erequests\u003C\u002Fcode\u003E gives us a nice and easy to use interface to make HTTP requests\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Chr\u003E\n\u003Ch1 id=\"researching-the-applications-lifecycle\"\u003EResearching the application&#39;s lifecycle\u003C\u002Fh1\u003E\n\u003Cp\u003EAs stated in the introduction, we&#39;re going to focus on searching on IMDB showing the rating for some selected title. Our first step should be to do these steps in a browser and see what it looks like there.\u003C\u002Fp\u003E\n\u003Cp\u003EVisit \u003Ca href=\"http:\u002F\u002Fwww.imdb.com\"\u003Ewww.imdb.com\u003C\u002Fa\u003E in your browser and search for a movie of your choice. I searched for \u003Cem\u003EJurassic Park\u003C\u002Fem\u003E, you should be greeted with something like the following image:\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\".\u002Fimages\u002Fimdb\u002Fjurassic_park_search_res.png\" alt=\"Jurassic Park search result on IMDB\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EOnce you&#39;re on this page, inspect one of the rows in the \u003Cem\u003E&quot;Titles&quot;\u003C\u002Fem\u003E table by right clicking and pressing \u003Cem\u003E&quot;Inspect element&quot;\u003C\u002Fem\u003E, this varies from browser to browser but in Firefox it looks like this:\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\".\u002Fimages\u002Fimdb\u002Finspect_element.png\" alt=\"Inspect element\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EYou might also have noticed that something opened up at the bottom of your browser, that section is commonly referred to as the dev tools. We&#39;ll be using that now to figure out the structure of the data that we&#39;re after. At the time of writing this, it looks like this:\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\".\u002Fimages\u002Fimdb\u002Fdev_tools.png\" alt=\"Dev tools open\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EWhat&#39;s displayed here is the \u003Ca href=\"https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FAPI\u002FDocument_Object_Model\u002FIntroduction\"\u003EDOM\u003C\u002Fa\u003E structure. The highlighted row here is what I selected when taking the \u003Cem\u003E&quot;Inspect element&quot;\u003C\u002Fem\u003E action earlier. This shows us how all the HTML nodes relate to each other and where in the DOM the data we&#39;re after is located. Since we want to be able to list these results in our application, we need to be able to present these search results.\u003C\u002Fp\u003E\n\u003Cp\u003EWe can see that the data we&#39;re interested in is located inside the \u003Ccode\u003E&lt;td&gt;\u003C\u002Fcode\u003E element with the class \u003Ccode\u003Eresult_text\u003C\u002Fcode\u003E, the name of the title is wrapped in an \u003Ccode\u003E&lt;a&gt;\u003C\u002Fcode\u003E element with the \u003Ccode\u003Ehref\u003C\u002Fcode\u003E holding the relative link to the title. This is all the data we need from this page.\u003C\u002Fp\u003E\n\u003Cp\u003ELet&#39;s follow the link to this title to see what the next page we need to tackle looks like, click the link to one of the search results and you should end up on the page for the movie\u002Fshow you picked:\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\".\u002Fimages\u002Fimdb\u002Fjurassic_park.png\" alt=\"Jurassic park\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EWhen on this page, let&#39;s repeat the step and \u003Cem\u003E&quot;Inspect element&quot;\u003C\u002Fem\u003E on the rating display:\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\".\u002Fimages\u002Fimdb\u002Finspect_element_2.png\" alt=\"Inspect rating element\"\u003E\n\u003Cimg src=\".\u002Fimages\u002Fimdb\u002Fdev_tools_2.png\" alt=\"Dev tools on inspect rating element\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EHere we can see that for this page the data we&#39;re interested in is located inside a \u003Ccode\u003Espan\u003C\u002Fcode\u003E element wrapped by a \u003Ccode\u003Estrong\u003C\u002Fcode\u003E element that is in turn wrapped by a \u003Ccode\u003Ediv\u003C\u002Fcode\u003E element with the class \u003Ccode\u003EratingValue\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003ENow that we have gathered all the information we need for our app, let&#39;s proceed to the coding part.\u003C\u002Fp\u003E\n\u003Chr\u003E\n\u003Ch1 id=\"searching-on-imdb-and-listing-the-titles\"\u003ESearching on IMDB and listing the titles\u003C\u002Fh1\u003E\n\u003Cp\u003ECreate a file \u003Ccode\u003Escrape.py\u003C\u002Fcode\u003E, this will be our only file for this project. In it we will begin by importing the required dependencies and adding search functionality:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Cdiv class=\"copy-me\" onclick=\"copyCode(this)\"\u003ECopy\u003C\u002Fdiv\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-comment\"\u003E# scrape.py\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E requests\n\u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E bs4 \u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E BeautifulSoup\n\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Esearch\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-params\"\u003Esearch_term\u003C\u002Fspan\u003E):\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-comment\"\u003E# Make the search request to IMDB\u003C\u002Fspan\u003E\n    response = requests.get(\u003Cspan class=\"hljs-string\"\u003Ef&quot;https:\u002F\u002Fwww.imdb.com\u002Ffind?q=\u003Cspan class=\"hljs-subst\"\u003E{search_term}\u003C\u002Fspan\u003E&quot;\u003C\u002Fspan\u003E)\n    html = response.text\n    soup = BeautifulSoup(html, \u003Cspan class=\"hljs-string\"\u003E&quot;html.parser&quot;\u003C\u002Fspan\u003E)\n    \u003Cspan class=\"hljs-comment\"\u003E# Find the table with the class findList\u003C\u002Fspan\u003E\n    table = soup.find(\u003Cspan class=\"hljs-string\"\u003E&quot;table&quot;\u003C\u002Fspan\u003E, {\u003Cspan class=\"hljs-string\"\u003E&quot;class&quot;\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-string\"\u003E&quot;findList&quot;\u003C\u002Fspan\u003E})\n    \u003Cspan class=\"hljs-comment\"\u003E# Use CSS selector syntax to get all td elements from the table with the class result_text\u003C\u002Fspan\u003E\n    rows = table.select(\u003Cspan class=\"hljs-string\"\u003E&quot;tr td.result_text&quot;\u003C\u002Fspan\u003E)\n    \u003Cspan class=\"hljs-comment\"\u003E# Construct a list with the search results, store the title and the href in dicts\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E [{\u003Cspan class=\"hljs-string\"\u003E&quot;title&quot;\u003C\u002Fspan\u003E: row.get_text().strip(), \u003Cspan class=\"hljs-string\"\u003E&quot;href&quot;\u003C\u002Fspan\u003E: row.a[\u003Cspan class=\"hljs-string\"\u003E&#x27;href&#x27;\u003C\u002Fspan\u003E]} \u003Cspan class=\"hljs-keyword\"\u003Efor\u003C\u002Fspan\u003E row \u003Cspan class=\"hljs-keyword\"\u003Ein\u003C\u002Fspan\u003E rows]\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003ELet&#39;s add another function to this file where we&#39;ll place our user interaction code:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Cdiv class=\"copy-me\" onclick=\"copyCode(this)\"\u003ECopy\u003C\u002Fdiv\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Erun\u003C\u002Fspan\u003E():\u003C\u002Fspan\u003E\n    search_term = \u003Cspan class=\"hljs-built_in\"\u003Einput\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E&quot;Search IMDB: &quot;\u003C\u002Fspan\u003E)\n    results = search(search_term)\n    num_results = \u003Cspan class=\"hljs-built_in\"\u003Elen\u003C\u002Fspan\u003E(results)\n    print(\u003Cspan class=\"hljs-string\"\u003Ef&quot;Found \u003Cspan class=\"hljs-subst\"\u003E{num_results}\u003C\u002Fspan\u003E results:&quot;\u003C\u002Fspan\u003E)\n    \u003Cspan class=\"hljs-comment\"\u003E# Use built-in function enumerate to access the index variable i\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Efor\u003C\u002Fspan\u003E i, result \u003Cspan class=\"hljs-keyword\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003Eenumerate\u003C\u002Fspan\u003E(results):\n        print(\u003Cspan class=\"hljs-string\"\u003Ef&quot;(\u003Cspan class=\"hljs-subst\"\u003E{i+\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E}\u003C\u002Fspan\u003E) \u003Cspan class=\"hljs-subst\"\u003E{result[\u003Cspan class=\"hljs-string\"\u003E&#x27;title&#x27;\u003C\u002Fspan\u003E]}\u003C\u002Fspan\u003E&quot;\u003C\u002Fspan\u003E)\n\n\u003Cspan class=\"hljs-comment\"\u003E# Don&#x27;t forget this line! We have to call the run function or nothing will happen when we run our program.\u003C\u002Fspan\u003E\nrun()\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003ESave the file and we&#39;re ready to try our app to see what it looks like right now, run it by going to the terminal and running:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Cdiv class=\"copy-me\" onclick=\"copyCode(this)\"\u003ECopy\u003C\u002Fdiv\u003E\u003Ccode\u003Epython3 scrape.py\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EEnter a search term and something similar should show up:\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\".\u002Fimages\u002Fimdb\u002Fin_app_search_res.png\" alt=\"in app search results\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EYou might notice that selecting a result does nothing at the moment, and that&#39;s cause we only implemented half the logic. It&#39;s always good to test that what you&#39;ve got so far is working at least, and if you&#39;re seeing search results in your terminal then you&#39;re good to continue.\u003C\u002Fp\u003E\n\u003Chr\u003E\n\u003Ch1 id=\"printing-the-rating-for-the-selected-title\"\u003EPrinting the rating for the selected title\u003C\u002Fh1\u003E\n\u003Cp\u003EWe need some more logic to request the next page and print the value from the \u003Ccode\u003Espan\u003C\u002Fcode\u003E element we identified earlier. You may have noticed that in the \u003Ccode\u003Esearch\u003C\u002Fcode\u003E function we defined, we&#39;re returning the \u003Ccode\u003Ehref\u003C\u002Fcode\u003Es but we&#39;re yet to use them. Let&#39;s incorporate them now.\u003C\u002Fp\u003E\n\u003Cp\u003EIn \u003Ccode\u003Escrape.py\u003C\u002Fcode\u003E, add another function:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Cdiv class=\"copy-me\" onclick=\"copyCode(this)\"\u003ECopy\u003C\u002Fdiv\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Eget_rating\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-params\"\u003Ehref\u003C\u002Fspan\u003E):\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-comment\"\u003E# href passed in here should be from what we found earlier, the href from the &lt;a&gt; tag that the title was wrapped in\u003C\u002Fspan\u003E\n    response = requests.get(\u003Cspan class=\"hljs-string\"\u003Ef&quot;https:\u002F\u002Fwww.imdb.com\u003Cspan class=\"hljs-subst\"\u003E{href}\u003C\u002Fspan\u003E&quot;\u003C\u002Fspan\u003E)\n    html = response.text\n    soup = BeautifulSoup(html, \u003Cspan class=\"hljs-string\"\u003E&quot;html.parser&quot;\u003C\u002Fspan\u003E)\n    \u003Cspan class=\"hljs-comment\"\u003E# Select by CSS selector for .ratingValue class and get the first result (index 0), we only expect there to be one\u003C\u002Fspan\u003E\n    rating = soup.select(\u003Cspan class=\"hljs-string\"\u003E&quot;.ratingValue&quot;\u003C\u002Fspan\u003E)[\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E].span.get_text()\n    \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E rating\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EAnd let&#39;s use it in our \u003Ccode\u003Erun\u003C\u002Fcode\u003E function:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Cdiv class=\"copy-me\" onclick=\"copyCode(this)\"\u003ECopy\u003C\u002Fdiv\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Erun\u003C\u002Fspan\u003E():\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-comment\"\u003E# Main interaction\u003C\u002Fspan\u003E\n    search_term = \u003Cspan class=\"hljs-built_in\"\u003Einput\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E&quot;Search IMDB: &quot;\u003C\u002Fspan\u003E)\n    results = search(search_term)\n    num_results = \u003Cspan class=\"hljs-built_in\"\u003Elen\u003C\u002Fspan\u003E(results)\n\n    print(\u003Cspan class=\"hljs-string\"\u003Ef&quot;Found \u003Cspan class=\"hljs-subst\"\u003E{num_results}\u003C\u002Fspan\u003E results:&quot;\u003C\u002Fspan\u003E)\n    \u003Cspan class=\"hljs-keyword\"\u003Efor\u003C\u002Fspan\u003E i, result \u003Cspan class=\"hljs-keyword\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003Eenumerate\u003C\u002Fspan\u003E(results):\n        print(\u003Cspan class=\"hljs-string\"\u003Ef&quot;(\u003Cspan class=\"hljs-subst\"\u003E{i+\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E}\u003C\u002Fspan\u003E) \u003Cspan class=\"hljs-subst\"\u003E{result[\u003Cspan class=\"hljs-string\"\u003E&#x27;title&#x27;\u003C\u002Fspan\u003E]}\u003C\u002Fspan\u003E&quot;\u003C\u002Fspan\u003E)\n\n    \u003Cspan class=\"hljs-comment\"\u003E# Convert to int and subtract one to undo the addition to the index in the above loop\u003C\u002Fspan\u003E\n    selection = \u003Cspan class=\"hljs-built_in\"\u003Eint\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-built_in\"\u003Einput\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003Ef&quot;Select by entering a number (1-\u003Cspan class=\"hljs-subst\"\u003E{num_results}\u003C\u002Fspan\u003E): &quot;\u003C\u002Fspan\u003E)) - \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E\n    selected_result = results[selection]\n    \u003Cspan class=\"hljs-comment\"\u003E# Pass in the href to the title we want to get the rating for\u003C\u002Fspan\u003E\n    rating = get_rating(selected_result[\u003Cspan class=\"hljs-string\"\u003E&quot;href&quot;\u003C\u002Fspan\u003E])\n\n    print(\u003Cspan class=\"hljs-string\"\u003Ef&quot;\u003Cspan class=\"hljs-subst\"\u003E{selected_result[\u003Cspan class=\"hljs-string\"\u003E&#x27;title&#x27;\u003C\u002Fspan\u003E]}\u003C\u002Fspan\u003E has a rating of \u003Cspan class=\"hljs-subst\"\u003E{rating}\u003C\u002Fspan\u003E!&quot;\u003C\u002Fspan\u003E)\n\n\u003Cspan class=\"hljs-comment\"\u003E# Again, make sure you call this in scrape.py\u003C\u002Fspan\u003E\nrun()\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003ERunning our app now results in the following behavior:\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\".\u002Fimages\u002Fimdb\u002Ffinal.png\" alt=\"Final output\"\u003E\u003C\u002Fp\u003E\n\u003Chr\u003E\n\u003Ch1 id=\"summary\"\u003ESummary\u003C\u002Fh1\u003E\n\u003Cp\u003EIf you can use an API to get ahold of the data that you&#39;re after, you should always do so, it&#39;s faster and less prone to errors. Scraping the web can get messy sometimes depending on the structure of the DOM. As you may have already figured out, if something was to change on the layout of IMDB, it would potentially break our app.\u003C\u002Fp\u003E\n\u003Cp\u003EI hope you learned something new and that you find the information provided here useful, maybe you were looking to use data from some site in your own project? Go ahead and try it out 😊.\u003C\u002Fp\u003E\n\u003Cp\u003EFeel free to ask any questions.\u003C\u002Fp\u003E\n\u003Cp\u003EEnjoy! \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fsimon-nystrom\u002Fsimple-web-scrape\"\u003EHere\u003C\u002Fa\u003E is the associated repository for this post.\u003C\u002Fp\u003E\n",date:"2020-11-01",slug:"web-scraping-python",title:"Web scraping with Python",categories:[],tags:["python","web-scraping","requests","tutorial","beautifulsoup"],summary:"Learn how to scrape web sites to access information programmatically using Python3, BeautifulSoup and Requests."}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/client.34c89fe8.js"}catch(e){main="/client/legacy/client.b34467f9.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@2.0.4.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> <link href=client/client-01038e3c.css rel=stylesheet><link href=client/Tag-401bb1aa.css rel=stylesheet><link href=client/[slug]-51b83dc6.css rel=stylesheet> <title>Web scraping with Python</title><meta content="Learn how to scrape web sites to access information programmatically using Python3, BeautifulSoup and Requests." name=description data-svelte=svelte-165u46n> <link href=/client/client.34c89fe8.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/client-01038e3c.css rel=preload as=style><link href=/client/[slug].c2f531ec.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/Tag.9134b38a.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/inject_styles.5607aec6.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/Tag-401bb1aa.css rel=preload as=style><link href=/client/[slug]-51b83dc6.css rel=preload as=style></head> <body> <div id=sapper> <nav class=svelte-tlf8d1><ul class=svelte-tlf8d1><li class=svelte-tlf8d1><a href=. class=svelte-tlf8d1>home</a></li> <li class=svelte-tlf8d1><a href=blog class=svelte-tlf8d1 rel=prefetch aria-current=page>blog</a></li> </ul></nav> <main class=svelte-11hgoe0> <h1 class=svelte-a9zrxd>Web scraping with Python</h1> <div class="svelte-a9zrxd meta"><h5 class="svelte-a9zrxd gray">2020-11-01</h5> <div class="svelte-a9zrxd gray">・</div> <div class="svelte-a9zrxd tags"><div class=svelte-17mm4dg>python</div><div class=svelte-17mm4dg>web-scraping</div><div class=svelte-17mm4dg>requests</div><div class=svelte-17mm4dg>tutorial</div><div class=svelte-17mm4dg>beautifulsoup</div></div></div> <div class="svelte-a9zrxd content"><p>Sometimes you want to access data on the web that isn't easily available through an API. For that, web scraping is a viable alternative. Web scraping is in essence a way to programmatically visit a web site as if you were a browser and fetch the data that way. This tutorial post will guide you through the process of web scraping using Python3, and two libraries <a href=https://www.crummy.com/software/BeautifulSoup/bs4/doc/ >BeautifulSoup</a> and <a href=https://requests.readthedocs.io/en/master/ >Requests</a>. As an example, we will build a command line application to search and print ratings for movies and TV shows on IMDB.</p> <hr> <h1 id=project-setup>Project setup</h1> <p>To follow along with the tutorial you will need to have the following:</p> <ul> <li><a href=https://www.python.org/downloads/ >Python</a> installed</li> <li>Some basic knowledge of Python and some basic HTML/CSS knowledge</li> </ul> <p>Alternatively you can check out <a href=https://newcurrent.se/blog/containerized-development-environment>my blog post for using dev containers</a> and follow that guide but select the <code>Python 3</code> container spec when creating the dev container. If you can't get the dev container way to work, you can refer to the <a href=https://github.com/simon-nystrom/simple-web-scrape>repository for this blog post</a>.</p> <p>Let's begin by creating a folder for our project and installing the required dependencies:</p> <pre><div class=copy-me onclick=copyCode(this)>Copy</div><code>mkdir web-scrape
<span class=hljs-built_in>cd</span> web-scrape
pip3 install beautifulsoup4 requests</code></pre><ul> <li><code>beautifulsoup4</code> lets us easily access DOM elements programmatically</li> <li><code>requests</code> gives us a nice and easy to use interface to make HTTP requests</li> </ul> <hr> <h1 id=researching-the-applications-lifecycle>Researching the application's lifecycle</h1> <p>As stated in the introduction, we're going to focus on searching on IMDB showing the rating for some selected title. Our first step should be to do these steps in a browser and see what it looks like there.</p> <p>Visit <a href=http://www.imdb.com>www.imdb.com</a> in your browser and search for a movie of your choice. I searched for <em>Jurassic Park</em>, you should be greeted with something like the following image:</p> <p><img alt="Jurassic Park search result on IMDB" src=./images/imdb/jurassic_park_search_res.png></p> <p>Once you're on this page, inspect one of the rows in the <em>"Titles"</em> table by right clicking and pressing <em>"Inspect element"</em>, this varies from browser to browser but in Firefox it looks like this:</p> <p><img alt="Inspect element" src=./images/imdb/inspect_element.png></p> <p>You might also have noticed that something opened up at the bottom of your browser, that section is commonly referred to as the dev tools. We'll be using that now to figure out the structure of the data that we're after. At the time of writing this, it looks like this:</p> <p><img alt="Dev tools open" src=./images/imdb/dev_tools.png></p> <p>What's displayed here is the <a href=https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model/Introduction>DOM</a> structure. The highlighted row here is what I selected when taking the <em>"Inspect element"</em> action earlier. This shows us how all the HTML nodes relate to each other and where in the DOM the data we're after is located. Since we want to be able to list these results in our application, we need to be able to present these search results.</p> <p>We can see that the data we're interested in is located inside the <code>&lt;td></code> element with the class <code>result_text</code>, the name of the title is wrapped in an <code>&lt;a></code> element with the <code>href</code> holding the relative link to the title. This is all the data we need from this page.</p> <p>Let's follow the link to this title to see what the next page we need to tackle looks like, click the link to one of the search results and you should end up on the page for the movie/show you picked:</p> <p><img alt="Jurassic park" src=./images/imdb/jurassic_park.png></p> <p>When on this page, let's repeat the step and <em>"Inspect element"</em> on the rating display:</p> <p><img alt="Inspect rating element" src=./images/imdb/inspect_element_2.png> <img alt="Dev tools on inspect rating element" src=./images/imdb/dev_tools_2.png></p> <p>Here we can see that for this page the data we're interested in is located inside a <code>span</code> element wrapped by a <code>strong</code> element that is in turn wrapped by a <code>div</code> element with the class <code>ratingValue</code>.</p> <p>Now that we have gathered all the information we need for our app, let's proceed to the coding part.</p> <hr> <h1 id=searching-on-imdb-and-listing-the-titles>Searching on IMDB and listing the titles</h1> <p>Create a file <code>scrape.py</code>, this will be our only file for this project. In it we will begin by importing the required dependencies and adding search functionality:</p> <pre><div class=copy-me onclick=copyCode(this)>Copy</div><code><span class=hljs-comment># scrape.py</span>
<span class=hljs-keyword>import</span> requests
<span class=hljs-keyword>from</span> bs4 <span class=hljs-keyword>import</span> BeautifulSoup

<span class=hljs-function><span class=hljs-keyword>def</span> <span class=hljs-title>search</span>(<span class=hljs-params>search_term</span>):</span>
    <span class=hljs-comment># Make the search request to IMDB</span>
    response = requests.get(<span class=hljs-string>f"https://www.imdb.com/find?q=<span class=hljs-subst>{search_term}</span>"</span>)
    html = response.text
    soup = BeautifulSoup(html, <span class=hljs-string>"html.parser"</span>)
    <span class=hljs-comment># Find the table with the class findList</span>
    table = soup.find(<span class=hljs-string>"table"</span>, {<span class=hljs-string>"class"</span>: <span class=hljs-string>"findList"</span>})
    <span class=hljs-comment># Use CSS selector syntax to get all td elements from the table with the class result_text</span>
    rows = table.select(<span class=hljs-string>"tr td.result_text"</span>)
    <span class=hljs-comment># Construct a list with the search results, store the title and the href in dicts</span>
    <span class=hljs-keyword>return</span> [{<span class=hljs-string>"title"</span>: row.get_text().strip(), <span class=hljs-string>"href"</span>: row.a[<span class=hljs-string>'href'</span>]} <span class=hljs-keyword>for</span> row <span class=hljs-keyword>in</span> rows]</code></pre><p>Let's add another function to this file where we'll place our user interaction code:</p> <pre><div class=copy-me onclick=copyCode(this)>Copy</div><code><span class=hljs-function><span class=hljs-keyword>def</span> <span class=hljs-title>run</span>():</span>
    search_term = <span class=hljs-built_in>input</span>(<span class=hljs-string>"Search IMDB: "</span>)
    results = search(search_term)
    num_results = <span class=hljs-built_in>len</span>(results)
    print(<span class=hljs-string>f"Found <span class=hljs-subst>{num_results}</span> results:"</span>)
    <span class=hljs-comment># Use built-in function enumerate to access the index variable i</span>
    <span class=hljs-keyword>for</span> i, result <span class=hljs-keyword>in</span> <span class=hljs-built_in>enumerate</span>(results):
        print(<span class=hljs-string>f"(<span class=hljs-subst>{i+<span class=hljs-number>1</span>}</span>) <span class=hljs-subst>{result[<span class=hljs-string>'title'</span>]}</span>"</span>)

<span class=hljs-comment># Don't forget this line! We have to call the run function or nothing will happen when we run our program.</span>
run()</code></pre><p>Save the file and we're ready to try our app to see what it looks like right now, run it by going to the terminal and running:</p> <pre><div class=copy-me onclick=copyCode(this)>Copy</div><code>python3 scrape.py</code></pre><p>Enter a search term and something similar should show up:</p> <p><img alt="in app search results" src=./images/imdb/in_app_search_res.png></p> <p>You might notice that selecting a result does nothing at the moment, and that's cause we only implemented half the logic. It's always good to test that what you've got so far is working at least, and if you're seeing search results in your terminal then you're good to continue.</p> <hr> <h1 id=printing-the-rating-for-the-selected-title>Printing the rating for the selected title</h1> <p>We need some more logic to request the next page and print the value from the <code>span</code> element we identified earlier. You may have noticed that in the <code>search</code> function we defined, we're returning the <code>href</code>s but we're yet to use them. Let's incorporate them now.</p> <p>In <code>scrape.py</code>, add another function:</p> <pre><div class=copy-me onclick=copyCode(this)>Copy</div><code><span class=hljs-function><span class=hljs-keyword>def</span> <span class=hljs-title>get_rating</span>(<span class=hljs-params>href</span>):</span>
    <span class=hljs-comment># href passed in here should be from what we found earlier, the href from the &lt;a> tag that the title was wrapped in</span>
    response = requests.get(<span class=hljs-string>f"https://www.imdb.com<span class=hljs-subst>{href}</span>"</span>)
    html = response.text
    soup = BeautifulSoup(html, <span class=hljs-string>"html.parser"</span>)
    <span class=hljs-comment># Select by CSS selector for .ratingValue class and get the first result (index 0), we only expect there to be one</span>
    rating = soup.select(<span class=hljs-string>".ratingValue"</span>)[<span class=hljs-number>0</span>].span.get_text()
    <span class=hljs-keyword>return</span> rating</code></pre><p>And let's use it in our <code>run</code> function:</p> <pre><div class=copy-me onclick=copyCode(this)>Copy</div><code><span class=hljs-function><span class=hljs-keyword>def</span> <span class=hljs-title>run</span>():</span>
    <span class=hljs-comment># Main interaction</span>
    search_term = <span class=hljs-built_in>input</span>(<span class=hljs-string>"Search IMDB: "</span>)
    results = search(search_term)
    num_results = <span class=hljs-built_in>len</span>(results)

    print(<span class=hljs-string>f"Found <span class=hljs-subst>{num_results}</span> results:"</span>)
    <span class=hljs-keyword>for</span> i, result <span class=hljs-keyword>in</span> <span class=hljs-built_in>enumerate</span>(results):
        print(<span class=hljs-string>f"(<span class=hljs-subst>{i+<span class=hljs-number>1</span>}</span>) <span class=hljs-subst>{result[<span class=hljs-string>'title'</span>]}</span>"</span>)

    <span class=hljs-comment># Convert to int and subtract one to undo the addition to the index in the above loop</span>
    selection = <span class=hljs-built_in>int</span>(<span class=hljs-built_in>input</span>(<span class=hljs-string>f"Select by entering a number (1-<span class=hljs-subst>{num_results}</span>): "</span>)) - <span class=hljs-number>1</span>
    selected_result = results[selection]
    <span class=hljs-comment># Pass in the href to the title we want to get the rating for</span>
    rating = get_rating(selected_result[<span class=hljs-string>"href"</span>])

    print(<span class=hljs-string>f"<span class=hljs-subst>{selected_result[<span class=hljs-string>'title'</span>]}</span> has a rating of <span class=hljs-subst>{rating}</span>!"</span>)

<span class=hljs-comment># Again, make sure you call this in scrape.py</span>
run()</code></pre><p>Running our app now results in the following behavior:</p> <p><img alt="Final output" src=./images/imdb/final.png></p> <hr> <h1 id=summary>Summary</h1> <p>If you can use an API to get ahold of the data that you're after, you should always do so, it's faster and less prone to errors. Scraping the web can get messy sometimes depending on the structure of the DOM. As you may have already figured out, if something was to change on the layout of IMDB, it would potentially break our app.</p> <p>I hope you learned something new and that you find the information provided here useful, maybe you were looking to use data from some site in your own project? Go ahead and try it out 😊.</p> <p>Feel free to ask any questions.</p> <p>Enjoy! <a href=https://github.com/simon-nystrom/simple-web-scrape>Here</a> is the associated repository for this post.</p> </div></main> <footer class=svelte-bn61n3><div class="svelte-bn61n3 copyright">Simon Nyström © 2020</div> <div class="svelte-bn61n3 social"><a href=https://www.linkedin.com/in/simon-nystr%C3%B6m-192b12a5/ class=icon-wrapper rel=noopener target=_blank><svg aria-hidden=true class="fa-svelte icon svelte-1d15yci" role=img viewBox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><path d="M100.3 480H7.4V180.9h92.9V480zM53.8 140.1C24.1 140.1 0 115.5 0 85.8 0 56.1 24.1 32 53.8 32c29.7 0 53.8 24.1 53.8 53.8 0 29.7-24.1 54.3-53.8 54.3zM448 480h-92.7V334.4c0-34.7-.7-79.2-48.3-79.2-48.3 0-55.7 37.7-55.7 76.7V480h-92.8V180.9h89.1v40.8h1.3c12.4-23.5 42.7-48.3 87.9-48.3 94 0 111.3 61.9 111.3 142.3V480z" fill=currentColor></path></svg></a> <a href=https://github.com/simon-nystrom/ class=icon-wrapper rel=noopener target=_blank><svg aria-hidden=true class="fa-svelte icon svelte-1d15yci" role=img viewBox="0 0 496 512" xmlns=http://www.w3.org/2000/svg><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z" fill=currentColor></path></svg></a> <a href=mailto:simon.nystrom90@gmail.com class=icon-wrapper rel=noopener target=_blank><svg aria-hidden=true class="fa-svelte icon svelte-1d15yci" role=img viewBox="0 0 512 512" xmlns=http://www.w3.org/2000/svg><path d="M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 400V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V400H48z" fill=currentColor></path></svg></a> <a href=https://dev.to/simonnystrom class="svelte-bn61n3 icon-wrapper"><img alt="Simon Nyström's DEV Profile" src=https://d2fltix0v2e0sb.cloudfront.net/dev-badge.svg class=svelte-bn61n3></a></div></footer></div> 