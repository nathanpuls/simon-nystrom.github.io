<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <base href=/ > <link href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/atom-one-dark-reasonable.min.css rel=stylesheet> <link href=global.css rel=stylesheet> <link href=manifest.json rel=manifest crossorigin=use-credentials> <link href=favicon.png rel=icon type=image/png> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,null,{post:{html:"\u003Cp\u003EThis post will walk you through how to create your own base for a CRUD (Create, Read, Update, Delete) API that will handle todos. We will be using Node.js, MongoDB, Express and Mongoose to create the API. \u003C\u002Fp\u003E\n\u003Chr\u003E\n\u003Ch1 id=\"project-setup\"\u003EProject setup\u003C\u002Fh1\u003E\n\u003Cp\u003ETo follow along with the blog you will need to have the following:\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fnodejs.org\u002Fen\u002Fdownload\u002F\"\u003ENode\u003C\u002Fa\u003E installed\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fwww.mongodb.com\u002Ftry\u002Fdownload\u002Fcommunity\"\u003EMongoDB\u003C\u002Fa\u003E installed and running on 27017 (default port)\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003EAlternatively you can check out \u003Ca href=\"https:\u002F\u002Fnewcurrent.se\u002Fblog\u002Fcontainerized-development-environment\"\u003Emy blog post for using dev containers\u003C\u002Fa\u003E and follow that guide but select the \u003Ccode\u003ENode.js &amp; Mongo DB\u003C\u002Fcode\u003E when creating the dev container. If you can&#39;t get the dev container way to work, you can refer to the \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fsimon-nystrom\u002Fnode-mongodb-crud-api\"\u003Erepository for this blog post\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003EThe first course of action is to initialize a project in a new folder using \u003Ccode\u003Enpm\u003C\u002Fcode\u003E, in your terminal run the following and complete the project setup:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Cdiv class=\"copy-me\" onclick=\"copyCode(this)\"\u003ECopy\u003C\u002Fdiv\u003E\u003Ccode\u003Emkdir my-crud-api\n\u003Cspan class=\"hljs-built_in\"\u003Ecd\u003C\u002Fspan\u003E my-crud-api\nnpm init\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003ESome basic dependencies are needed to create the API:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Cdiv class=\"copy-me\" onclick=\"copyCode(this)\"\u003ECopy\u003C\u002Fdiv\u003E\u003Ccode\u003Enpm install mongoose body-parser express@^5.0.0-alpha.8\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cul\u003E\n\u003Cli\u003E\u003Ccode\u003Emongoose\u003C\u002Fcode\u003E will be used to connect to MongoDB easily and create a schema for the Todo item.\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003Ebody-parser\u003C\u002Fcode\u003E will be used to enable parsing JSON requests easily.\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003Eexpress\u003C\u002Fcode\u003E will be used to set up the HTTP server, we&#39;ll use the alpha version for 5.0 to simplify our code a little bit.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Chr\u003E\n\u003Ch1 id=\"setting-up-the-web-server\"\u003ESetting up the web server\u003C\u002Fh1\u003E\n\u003Cp\u003EBegin by creating a file called \u003Ccode\u003Eindex.js\u003C\u002Fcode\u003E. This will be the entry point to our application and it is in this file that we will start and initialize our web server.\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Cdiv class=\"copy-me\" onclick=\"copyCode(this)\"\u003ECopy\u003C\u002Fdiv\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F index.js\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E express = \u003Cspan class=\"hljs-built_in\"\u003Erequire\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E&quot;express&quot;\u003C\u002Fspan\u003E);\n\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E app = express();\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Wrap our starting logic in an async function so we can use await syntax\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E startApplication = \u003Cspan class=\"hljs-keyword\"\u003Easync\u003C\u002Fspan\u003E () =&gt; {\n  \u003Cspan class=\"hljs-keyword\"\u003Eawait\u003C\u002Fspan\u003E app.listen(\u003Cspan class=\"hljs-number\"\u003E8000\u003C\u002Fspan\u003E);\n  \u003Cspan class=\"hljs-built_in\"\u003Econsole\u003C\u002Fspan\u003E.log(\u003Cspan class=\"hljs-string\"\u003E&quot;Listening on 8000...&quot;\u003C\u002Fspan\u003E);\n};\n\nstartApplication();\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003ENow if you run \u003Ccode\u003Enode index.js\u003C\u002Fcode\u003E in your terminal, your web server should be running and listening on port \u003Ccode\u003E8000\u003C\u002Fcode\u003E, you can verify that by going to \u003Ca href=\"http:\u002F\u002Flocalhost:8000\"\u003Ehttp:\u002F\u002Flocalhost:8000\u003C\u002Fa\u003E and you should be greeted with the string \u003Ccode\u003ECannot GET \u002F\u003C\u002Fcode\u003E. That means your server is working, albeit quite meaningless for now.\u003C\u002Fp\u003E\n\u003Chr\u003E\n\u003Ch1 id=\"creating-the-todo-model-and-router\"\u003ECreating the Todo model and router\u003C\u002Fh1\u003E\n\u003Cp\u003ECreate a new folder in the root directory of your project and call it \u003Ccode\u003Esrc\u003C\u002Fcode\u003E, inside this new folder create two files called \u003Ccode\u003Etodo.js\u003C\u002Fcode\u003E and \u003Ccode\u003EtodoRouter.js\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003EWe&#39;ll place our model in the \u003Ccode\u003Etodo.js\u003C\u002Fcode\u003E file. This will be the schema defined with help of \u003Ccode\u003EMongoose\u003C\u002Fcode\u003E that we installed earlier.\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Cdiv class=\"copy-me\" onclick=\"copyCode(this)\"\u003ECopy\u003C\u002Fdiv\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F src\u002Ftodo.js\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E mongoose = \u003Cspan class=\"hljs-built_in\"\u003Erequire\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E&quot;mongoose&quot;\u003C\u002Fspan\u003E);\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Create a mongoose schema, make title and createdAt be the properties and make them required\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E todoSchema = \u003Cspan class=\"hljs-keyword\"\u003Enew\u003C\u002Fspan\u003E mongoose.Schema({\n  \u003Cspan class=\"hljs-attr\"\u003Etitle\u003C\u002Fspan\u003E: { \u003Cspan class=\"hljs-attr\"\u003Etype\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-built_in\"\u003EString\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-attr\"\u003Erequired\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E },\n  \u003Cspan class=\"hljs-attr\"\u003EcreatedAt\u003C\u002Fspan\u003E: { \u003Cspan class=\"hljs-attr\"\u003Etype\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-built_in\"\u003EDate\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-attr\"\u003Erequired\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E },\n});\n\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E Todo = mongoose.model(\u003Cspan class=\"hljs-string\"\u003E&quot;Todo&quot;\u003C\u002Fspan\u003E, todoSchema);\n\n\u003Cspan class=\"hljs-built_in\"\u003Emodule\u003C\u002Fspan\u003E.exports = Todo;\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EThis \u003Ccode\u003ETodo\u003C\u002Fcode\u003E object that we export from \u003Ccode\u003Esrc\u002Ftodo.js\u003C\u002Fcode\u003E is the object that we will use to handle the database connections needed to interact with the database and create, read, update and delete todos. Let&#39;s use it in our router and define routes for all the actions we want to support:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Cdiv class=\"copy-me\" onclick=\"copyCode(this)\"\u003ECopy\u003C\u002Fdiv\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F src\u002FtodoRouter.js\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E express = \u003Cspan class=\"hljs-built_in\"\u003Erequire\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E&quot;express&quot;\u003C\u002Fspan\u003E);\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E Todo = \u003Cspan class=\"hljs-built_in\"\u003Erequire\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E&quot;.\u002Ftodo&quot;\u003C\u002Fspan\u003E);\n\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E todoRouter = express.Router();\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F List all todos\u003C\u002Fspan\u003E\ntodoRouter.get(\u003Cspan class=\"hljs-string\"\u003E&quot;\u002F&quot;\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-keyword\"\u003Easync\u003C\u002Fspan\u003E (_, res) =&gt; {\n  res.json(\u003Cspan class=\"hljs-keyword\"\u003Eawait\u003C\u002Fspan\u003E Todo.find({}));\n});\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Read todo by ID\u003C\u002Fspan\u003E\ntodoRouter.get(\u003Cspan class=\"hljs-string\"\u003E&quot;\u002F:todoId&quot;\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-keyword\"\u003Easync\u003C\u002Fspan\u003E (req, res) =&gt; {\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E { todoId } = req.params;\n  res.json(\u003Cspan class=\"hljs-keyword\"\u003Eawait\u003C\u002Fspan\u003E Todo.findById({ \u003Cspan class=\"hljs-attr\"\u003E_id\u003C\u002Fspan\u003E: todoId }));\n});\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Delete todo by ID\u003C\u002Fspan\u003E\ntodoRouter.delete(\u003Cspan class=\"hljs-string\"\u003E&quot;\u002F:todoId&quot;\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-keyword\"\u003Easync\u003C\u002Fspan\u003E (req, res) =&gt; {\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E { todoId } = req.params;\n  \u003Cspan class=\"hljs-keyword\"\u003Eawait\u003C\u002Fspan\u003E Todo.deleteOne({ \u003Cspan class=\"hljs-attr\"\u003E_id\u003C\u002Fspan\u003E: todoId });\n  res.status(\u003Cspan class=\"hljs-number\"\u003E204\u003C\u002Fspan\u003E).send();\n});\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Update todo by ID\u003C\u002Fspan\u003E\ntodoRouter.put(\u003Cspan class=\"hljs-string\"\u003E&quot;\u002F:todoId&quot;\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-keyword\"\u003Easync\u003C\u002Fspan\u003E (req, res) =&gt; {\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E { title } = req.body;\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E { todoId } = req.params;\n  res.json(\u003Cspan class=\"hljs-keyword\"\u003Eawait\u003C\u002Fspan\u003E Todo.updateOne({ \u003Cspan class=\"hljs-attr\"\u003E_id\u003C\u002Fspan\u003E: todoId }, { title }));\n});\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Create a todo\u003C\u002Fspan\u003E\ntodoRouter.post(\u003Cspan class=\"hljs-string\"\u003E&quot;\u002F&quot;\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-keyword\"\u003Easync\u003C\u002Fspan\u003E (req, res) =&gt; {\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E { title } = req.body;\n  res.json(\u003Cspan class=\"hljs-keyword\"\u003Eawait\u003C\u002Fspan\u003E Todo.create({ title, \u003Cspan class=\"hljs-attr\"\u003EcreatedAt\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003EDate\u003C\u002Fspan\u003E() }));\n});\n\n\u003Cspan class=\"hljs-built_in\"\u003Emodule\u003C\u002Fspan\u003E.exports = todoRouter;\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Chr\u003E\n\u003Ch1 id=\"using-the-router-in-our-server\"\u003EUsing the router in our server\u003C\u002Fh1\u003E\n\u003Cp\u003EOnce the two files in the previous example have been created, it&#39;s time to hook the router up to our app and to connect to MongoDB using \u003Ccode\u003Emongoose\u003C\u002Fcode\u003E:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Cdiv class=\"copy-me\" onclick=\"copyCode(this)\"\u003ECopy\u003C\u002Fdiv\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F index.js\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E bodyParser = \u003Cspan class=\"hljs-built_in\"\u003Erequire\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E&quot;body-parser&quot;\u003C\u002Fspan\u003E);\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E express = \u003Cspan class=\"hljs-built_in\"\u003Erequire\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E&quot;express&quot;\u003C\u002Fspan\u003E);\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E mongoose = \u003Cspan class=\"hljs-built_in\"\u003Erequire\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E&quot;mongoose&quot;\u003C\u002Fspan\u003E);\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E todoRouter = \u003Cspan class=\"hljs-built_in\"\u003Erequire\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E&quot;.\u002Fsrc\u002FtodoRouter&quot;\u003C\u002Fspan\u003E);\n\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E app = express();\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Add body-parser middleware to automatically parse JSON requests\u003C\u002Fspan\u003E\napp.use(bodyParser.json());\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Requests done to the base path \u002Ftodo should go through the todoRouter\u003C\u002Fspan\u003E\napp.use(\u003Cspan class=\"hljs-string\"\u003E&quot;\u002Ftodo&quot;\u003C\u002Fspan\u003E, todoRouter);\n\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E startApplication = \u003Cspan class=\"hljs-keyword\"\u003Easync\u003C\u002Fspan\u003E () =&gt; {\n  \u003Cspan class=\"hljs-keyword\"\u003Eawait\u003C\u002Fspan\u003E mongoose.connect(\u003Cspan class=\"hljs-string\"\u003E&quot;mongodb:\u002F\u002Flocalhost:27017\u002Ftodo&quot;\u003C\u002Fspan\u003E, {\n    \u003Cspan class=\"hljs-attr\"\u003EuseNewUrlParser\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E,\n    \u003Cspan class=\"hljs-attr\"\u003EuseUnifiedTopology\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E,\n  });\n  \u003Cspan class=\"hljs-built_in\"\u003Econsole\u003C\u002Fspan\u003E.log(\n    \u003Cspan class=\"hljs-string\"\u003E&quot;Successfully connected to MongoDB at: mongodb:\u002F\u002Flocalhost:27017\u002Ftodo&quot;\u003C\u002Fspan\u003E\n  );\n  \u003Cspan class=\"hljs-keyword\"\u003Eawait\u003C\u002Fspan\u003E app.listen(\u003Cspan class=\"hljs-number\"\u003E8000\u003C\u002Fspan\u003E);\n  \u003Cspan class=\"hljs-built_in\"\u003Econsole\u003C\u002Fspan\u003E.log(\u003Cspan class=\"hljs-string\"\u003E&quot;Listening on 8000...&quot;\u003C\u002Fspan\u003E);\n};\n\nstartApplication();\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Chr\u003E\n\u003Ch1 id=\"sending-some-requests\"\u003ESending some requests\u003C\u002Fh1\u003E\n\u003Cp\u003EOnce the \u003Ccode\u003Eindex.js\u003C\u002Fcode\u003E file has been extended with the additional functionalities above, you can restart your server and we are ready to send some requests using our terminal (you can of course use Postman or Insomnia or other ways of sending requests too):\u003C\u002Fp\u003E\n\u003Ch3 id=\"create-a-todo-note-the-_id\"\u003ECreate a todo (note the _id):\u003C\u002Fh3\u003E\n\u003Cpre\u003E\u003Cdiv class=\"copy-me\" onclick=\"copyCode(this)\"\u003ECopy\u003C\u002Fdiv\u003E\u003Ccode\u003Ecurl -XPOST -H\u003Cspan class=\"hljs-string\"\u003E&#x27;Content-Type:application\u002Fjson&#x27;\u003C\u002Fspan\u003E -d\u003Cspan class=\"hljs-string\"\u003E&#x27;{&quot;title&quot;: &quot;My first todo!&quot;}&#x27;\u003C\u002Fspan\u003E localhost:8000\u002Ftodo\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch3 id=\"update-the-todo-use-the-_id-from-above\"\u003EUpdate the todo (use the _id from above):\u003C\u002Fh3\u003E\n\u003Cpre\u003E\u003Cdiv class=\"copy-me\" onclick=\"copyCode(this)\"\u003ECopy\u003C\u002Fdiv\u003E\u003Ccode\u003Ecurl -XPUT -H\u003Cspan class=\"hljs-string\"\u003E&#x27;Content-Type:application\u002Fjson&#x27;\u003C\u002Fspan\u003E -d\u003Cspan class=\"hljs-string\"\u003E&#x27;{&quot;title&quot;: &quot;My first todo! But updated!&quot;}&#x27;\u003C\u002Fspan\u003E localhost:8000\u002Ftodo\u002F5f8f221fdb30b30457e23e1c\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch3 id=\"read-the-todo-use-the-_id-from-above\"\u003ERead the todo (use the _id from above):\u003C\u002Fh3\u003E\n\u003Cpre\u003E\u003Cdiv class=\"copy-me\" onclick=\"copyCode(this)\"\u003ECopy\u003C\u002Fdiv\u003E\u003Ccode\u003Ecurl -XPUT -H\u003Cspan class=\"hljs-string\"\u003E&#x27;Content-Type:application\u002Fjson&#x27;\u003C\u002Fspan\u003E -d\u003Cspan class=\"hljs-string\"\u003E&#x27;{&quot;title&quot;: &quot;My first todo! But updated!&quot;}&#x27;\u003C\u002Fspan\u003E localhost:8000\u002Ftodo\u002F5f8f221fdb30b30457e23e1c\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch3 id=\"delete-the-todo-use-the-_id-from-above\"\u003EDelete the todo (use the _id from above):\u003C\u002Fh3\u003E\n\u003Cpre\u003E\u003Cdiv class=\"copy-me\" onclick=\"copyCode(this)\"\u003ECopy\u003C\u002Fdiv\u003E\u003Ccode\u003Ecurl -XDELETE localhost:8000\u002Ftodo\u002F5f8f221fdb30b30457e23e1c\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch3 id=\"list-all-todos\"\u003EList all todos:\u003C\u002Fh3\u003E\n\u003Cpre\u003E\u003Cdiv class=\"copy-me\" onclick=\"copyCode(this)\"\u003ECopy\u003C\u002Fdiv\u003E\u003Ccode\u003Ecurl -H\u003Cspan class=\"hljs-string\"\u003E&#x27;Content-Type:application\u002Fjson&#x27;\u003C\u002Fspan\u003E localhost:8000\u002Ftodo\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Chr\u003E\n\u003Cp\u003EI hope you learned something. Creating a basic API using the method above is quick and easy if you want to get a prototype up and running fast.\u003C\u002Fp\u003E\n\u003Cp\u003EEnjoy!\u003C\u002Fp\u003E\n",date:"2020-10-20",slug:"crud-api-node-mongodb",title:"Create a CRUD API with Node.js and MongoDB",categories:[],tags:["node","mongodb","express","javascript","mongoose"],summary:"Learn how to create a CRUD API using Node.js, MongoDB and Express."}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/client.34c89fe8.js"}catch(e){main="/client/legacy/client.b34467f9.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@2.0.4.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> <link href=client/client-01038e3c.css rel=stylesheet><link href=client/Tag-401bb1aa.css rel=stylesheet><link href=client/[slug]-51b83dc6.css rel=stylesheet> <title>Create a CRUD API with Node.js and MongoDB</title><meta content="Learn how to create a CRUD API using Node.js, MongoDB and Express." name=description data-svelte=svelte-165u46n> <link href=/client/client.34c89fe8.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/client-01038e3c.css rel=preload as=style><link href=/client/[slug].c2f531ec.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/Tag.9134b38a.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/inject_styles.5607aec6.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/Tag-401bb1aa.css rel=preload as=style><link href=/client/[slug]-51b83dc6.css rel=preload as=style></head> <body> <div id=sapper> <nav class=svelte-tlf8d1><ul class=svelte-tlf8d1><li class=svelte-tlf8d1><a href=. class=svelte-tlf8d1>home</a></li> <li class=svelte-tlf8d1><a href=blog class=svelte-tlf8d1 rel=prefetch aria-current=page>blog</a></li> </ul></nav> <main class=svelte-11hgoe0> <h1 class=svelte-a9zrxd>Create a CRUD API with Node.js and MongoDB</h1> <div class="svelte-a9zrxd meta"><h5 class="svelte-a9zrxd gray">2020-10-20</h5> <div class="svelte-a9zrxd gray">・</div> <div class="svelte-a9zrxd tags"><div class=svelte-17mm4dg>node</div><div class=svelte-17mm4dg>mongodb</div><div class=svelte-17mm4dg>express</div><div class=svelte-17mm4dg>javascript</div><div class=svelte-17mm4dg>mongoose</div></div></div> <div class="svelte-a9zrxd content"><p>This post will walk you through how to create your own base for a CRUD (Create, Read, Update, Delete) API that will handle todos. We will be using Node.js, MongoDB, Express and Mongoose to create the API. </p> <hr> <h1 id=project-setup>Project setup</h1> <p>To follow along with the blog you will need to have the following:</p> <ul> <li><a href=https://nodejs.org/en/download/ >Node</a> installed</li> <li><a href=https://www.mongodb.com/try/download/community>MongoDB</a> installed and running on 27017 (default port)</li> </ul> <p>Alternatively you can check out <a href=https://newcurrent.se/blog/containerized-development-environment>my blog post for using dev containers</a> and follow that guide but select the <code>Node.js & Mongo DB</code> when creating the dev container. If you can't get the dev container way to work, you can refer to the <a href=https://github.com/simon-nystrom/node-mongodb-crud-api>repository for this blog post</a>.</p> <p>The first course of action is to initialize a project in a new folder using <code>npm</code>, in your terminal run the following and complete the project setup:</p> <pre><div class=copy-me onclick=copyCode(this)>Copy</div><code>mkdir my-crud-api
<span class=hljs-built_in>cd</span> my-crud-api
npm init</code></pre><p>Some basic dependencies are needed to create the API:</p> <pre><div class=copy-me onclick=copyCode(this)>Copy</div><code>npm install mongoose body-parser express@^5.0.0-alpha.8</code></pre><ul> <li><code>mongoose</code> will be used to connect to MongoDB easily and create a schema for the Todo item.</li> <li><code>body-parser</code> will be used to enable parsing JSON requests easily.</li> <li><code>express</code> will be used to set up the HTTP server, we'll use the alpha version for 5.0 to simplify our code a little bit.</li> </ul> <hr> <h1 id=setting-up-the-web-server>Setting up the web server</h1> <p>Begin by creating a file called <code>index.js</code>. This will be the entry point to our application and it is in this file that we will start and initialize our web server.</p> <pre><div class=copy-me onclick=copyCode(this)>Copy</div><code><span class=hljs-comment>// index.js</span>
<span class=hljs-keyword>const</span> express = <span class=hljs-built_in>require</span>(<span class=hljs-string>"express"</span>);

<span class=hljs-keyword>const</span> app = express();

<span class=hljs-comment>// Wrap our starting logic in an async function so we can use await syntax</span>
<span class=hljs-keyword>const</span> startApplication = <span class=hljs-keyword>async</span> () => {
  <span class=hljs-keyword>await</span> app.listen(<span class=hljs-number>8000</span>);
  <span class=hljs-built_in>console</span>.log(<span class=hljs-string>"Listening on 8000..."</span>);
};

startApplication();</code></pre><p>Now if you run <code>node index.js</code> in your terminal, your web server should be running and listening on port <code>8000</code>, you can verify that by going to <a href=http://localhost:8000>http://localhost:8000</a> and you should be greeted with the string <code>Cannot GET /</code>. That means your server is working, albeit quite meaningless for now.</p> <hr> <h1 id=creating-the-todo-model-and-router>Creating the Todo model and router</h1> <p>Create a new folder in the root directory of your project and call it <code>src</code>, inside this new folder create two files called <code>todo.js</code> and <code>todoRouter.js</code>.</p> <p>We'll place our model in the <code>todo.js</code> file. This will be the schema defined with help of <code>Mongoose</code> that we installed earlier.</p> <pre><div class=copy-me onclick=copyCode(this)>Copy</div><code><span class=hljs-comment>// src/todo.js</span>
<span class=hljs-keyword>const</span> mongoose = <span class=hljs-built_in>require</span>(<span class=hljs-string>"mongoose"</span>);

<span class=hljs-comment>// Create a mongoose schema, make title and createdAt be the properties and make them required</span>
<span class=hljs-keyword>const</span> todoSchema = <span class=hljs-keyword>new</span> mongoose.Schema({
  <span class=hljs-attr>title</span>: { <span class=hljs-attr>type</span>: <span class=hljs-built_in>String</span>, <span class=hljs-attr>required</span>: <span class=hljs-literal>true</span> },
  <span class=hljs-attr>createdAt</span>: { <span class=hljs-attr>type</span>: <span class=hljs-built_in>Date</span>, <span class=hljs-attr>required</span>: <span class=hljs-literal>true</span> },
});

<span class=hljs-keyword>const</span> Todo = mongoose.model(<span class=hljs-string>"Todo"</span>, todoSchema);

<span class=hljs-built_in>module</span>.exports = Todo;</code></pre><p>This <code>Todo</code> object that we export from <code>src/todo.js</code> is the object that we will use to handle the database connections needed to interact with the database and create, read, update and delete todos. Let's use it in our router and define routes for all the actions we want to support:</p> <pre><div class=copy-me onclick=copyCode(this)>Copy</div><code><span class=hljs-comment>// src/todoRouter.js</span>
<span class=hljs-keyword>const</span> express = <span class=hljs-built_in>require</span>(<span class=hljs-string>"express"</span>);
<span class=hljs-keyword>const</span> Todo = <span class=hljs-built_in>require</span>(<span class=hljs-string>"./todo"</span>);

<span class=hljs-keyword>const</span> todoRouter = express.Router();

<span class=hljs-comment>// List all todos</span>
todoRouter.get(<span class=hljs-string>"/"</span>, <span class=hljs-keyword>async</span> (_, res) => {
  res.json(<span class=hljs-keyword>await</span> Todo.find({}));
});

<span class=hljs-comment>// Read todo by ID</span>
todoRouter.get(<span class=hljs-string>"/:todoId"</span>, <span class=hljs-keyword>async</span> (req, res) => {
  <span class=hljs-keyword>const</span> { todoId } = req.params;
  res.json(<span class=hljs-keyword>await</span> Todo.findById({ <span class=hljs-attr>_id</span>: todoId }));
});

<span class=hljs-comment>// Delete todo by ID</span>
todoRouter.delete(<span class=hljs-string>"/:todoId"</span>, <span class=hljs-keyword>async</span> (req, res) => {
  <span class=hljs-keyword>const</span> { todoId } = req.params;
  <span class=hljs-keyword>await</span> Todo.deleteOne({ <span class=hljs-attr>_id</span>: todoId });
  res.status(<span class=hljs-number>204</span>).send();
});

<span class=hljs-comment>// Update todo by ID</span>
todoRouter.put(<span class=hljs-string>"/:todoId"</span>, <span class=hljs-keyword>async</span> (req, res) => {
  <span class=hljs-keyword>const</span> { title } = req.body;
  <span class=hljs-keyword>const</span> { todoId } = req.params;
  res.json(<span class=hljs-keyword>await</span> Todo.updateOne({ <span class=hljs-attr>_id</span>: todoId }, { title }));
});

<span class=hljs-comment>// Create a todo</span>
todoRouter.post(<span class=hljs-string>"/"</span>, <span class=hljs-keyword>async</span> (req, res) => {
  <span class=hljs-keyword>const</span> { title } = req.body;
  res.json(<span class=hljs-keyword>await</span> Todo.create({ title, <span class=hljs-attr>createdAt</span>: <span class=hljs-keyword>new</span> <span class=hljs-built_in>Date</span>() }));
});

<span class=hljs-built_in>module</span>.exports = todoRouter;</code></pre><hr> <h1 id=using-the-router-in-our-server>Using the router in our server</h1> <p>Once the two files in the previous example have been created, it's time to hook the router up to our app and to connect to MongoDB using <code>mongoose</code>:</p> <pre><div class=copy-me onclick=copyCode(this)>Copy</div><code><span class=hljs-comment>// index.js</span>
<span class=hljs-keyword>const</span> bodyParser = <span class=hljs-built_in>require</span>(<span class=hljs-string>"body-parser"</span>);
<span class=hljs-keyword>const</span> express = <span class=hljs-built_in>require</span>(<span class=hljs-string>"express"</span>);
<span class=hljs-keyword>const</span> mongoose = <span class=hljs-built_in>require</span>(<span class=hljs-string>"mongoose"</span>);
<span class=hljs-keyword>const</span> todoRouter = <span class=hljs-built_in>require</span>(<span class=hljs-string>"./src/todoRouter"</span>);

<span class=hljs-keyword>const</span> app = express();

<span class=hljs-comment>// Add body-parser middleware to automatically parse JSON requests</span>
app.use(bodyParser.json());
<span class=hljs-comment>// Requests done to the base path /todo should go through the todoRouter</span>
app.use(<span class=hljs-string>"/todo"</span>, todoRouter);

<span class=hljs-keyword>const</span> startApplication = <span class=hljs-keyword>async</span> () => {
  <span class=hljs-keyword>await</span> mongoose.connect(<span class=hljs-string>"mongodb://localhost:27017/todo"</span>, {
    <span class=hljs-attr>useNewUrlParser</span>: <span class=hljs-literal>true</span>,
    <span class=hljs-attr>useUnifiedTopology</span>: <span class=hljs-literal>true</span>,
  });
  <span class=hljs-built_in>console</span>.log(
    <span class=hljs-string>"Successfully connected to MongoDB at: mongodb://localhost:27017/todo"</span>
  );
  <span class=hljs-keyword>await</span> app.listen(<span class=hljs-number>8000</span>);
  <span class=hljs-built_in>console</span>.log(<span class=hljs-string>"Listening on 8000..."</span>);
};

startApplication();</code></pre><hr> <h1 id=sending-some-requests>Sending some requests</h1> <p>Once the <code>index.js</code> file has been extended with the additional functionalities above, you can restart your server and we are ready to send some requests using our terminal (you can of course use Postman or Insomnia or other ways of sending requests too):</p> <h3 id=create-a-todo-note-the-_id>Create a todo (note the _id):</h3> <pre><div class=copy-me onclick=copyCode(this)>Copy</div><code>curl -XPOST -H<span class=hljs-string>'Content-Type:application/json'</span> -d<span class=hljs-string>'{"title": "My first todo!"}'</span> localhost:8000/todo</code></pre><h3 id=update-the-todo-use-the-_id-from-above>Update the todo (use the _id from above):</h3> <pre><div class=copy-me onclick=copyCode(this)>Copy</div><code>curl -XPUT -H<span class=hljs-string>'Content-Type:application/json'</span> -d<span class=hljs-string>'{"title": "My first todo! But updated!"}'</span> localhost:8000/todo/5f8f221fdb30b30457e23e1c</code></pre><h3 id=read-the-todo-use-the-_id-from-above>Read the todo (use the _id from above):</h3> <pre><div class=copy-me onclick=copyCode(this)>Copy</div><code>curl -XPUT -H<span class=hljs-string>'Content-Type:application/json'</span> -d<span class=hljs-string>'{"title": "My first todo! But updated!"}'</span> localhost:8000/todo/5f8f221fdb30b30457e23e1c</code></pre><h3 id=delete-the-todo-use-the-_id-from-above>Delete the todo (use the _id from above):</h3> <pre><div class=copy-me onclick=copyCode(this)>Copy</div><code>curl -XDELETE localhost:8000/todo/5f8f221fdb30b30457e23e1c</code></pre><h3 id=list-all-todos>List all todos:</h3> <pre><div class=copy-me onclick=copyCode(this)>Copy</div><code>curl -H<span class=hljs-string>'Content-Type:application/json'</span> localhost:8000/todo</code></pre><hr> <p>I hope you learned something. Creating a basic API using the method above is quick and easy if you want to get a prototype up and running fast.</p> <p>Enjoy!</p> </div></main> <footer class=svelte-bn61n3><div class="svelte-bn61n3 copyright">Simon Nyström © 2020</div> <div class="svelte-bn61n3 social"><a href=https://www.linkedin.com/in/simon-nystr%C3%B6m-192b12a5/ class=icon-wrapper rel=noopener target=_blank><svg aria-hidden=true class="fa-svelte icon svelte-1d15yci" role=img viewBox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><path d="M100.3 480H7.4V180.9h92.9V480zM53.8 140.1C24.1 140.1 0 115.5 0 85.8 0 56.1 24.1 32 53.8 32c29.7 0 53.8 24.1 53.8 53.8 0 29.7-24.1 54.3-53.8 54.3zM448 480h-92.7V334.4c0-34.7-.7-79.2-48.3-79.2-48.3 0-55.7 37.7-55.7 76.7V480h-92.8V180.9h89.1v40.8h1.3c12.4-23.5 42.7-48.3 87.9-48.3 94 0 111.3 61.9 111.3 142.3V480z" fill=currentColor></path></svg></a> <a href=https://github.com/simon-nystrom/ class=icon-wrapper rel=noopener target=_blank><svg aria-hidden=true class="fa-svelte icon svelte-1d15yci" role=img viewBox="0 0 496 512" xmlns=http://www.w3.org/2000/svg><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z" fill=currentColor></path></svg></a> <a href=mailto:simon.nystrom90@gmail.com class=icon-wrapper rel=noopener target=_blank><svg aria-hidden=true class="fa-svelte icon svelte-1d15yci" role=img viewBox="0 0 512 512" xmlns=http://www.w3.org/2000/svg><path d="M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 400V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V400H48z" fill=currentColor></path></svg></a> <a href=https://dev.to/simonnystrom class="svelte-bn61n3 icon-wrapper"><img alt="Simon Nyström's DEV Profile" class=svelte-bn61n3 src=https://d2fltix0v2e0sb.cloudfront.net/dev-badge.svg></a></div></footer></div> 