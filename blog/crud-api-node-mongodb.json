{"html":"<p>This post will walk you through how to create your own base for a CRUD (Create, Read, Update, Delete) API that will handle todos. We will be using Node.js, MongoDB, Express and Mongoose to create the API. </p>\n<hr>\n<h1 id=\"project-setup\">Project setup</h1>\n<p>To follow along with the blog you will need to have the following:</p>\n<ul>\n<li><a href=\"https://nodejs.org/en/download/\">Node</a> installed</li>\n<li><a href=\"https://www.mongodb.com/try/download/community\">MongoDB</a> installed and running on 27017 (default port)</li>\n</ul>\n<p>Alternatively you can check out <a href=\"https://newcurrent.se/blog/containerized-development-environment\">my blog post for using dev containers</a> and follow that guide but select the <code>Node.js &amp; Mongo DB</code> when creating the dev container. If you can&#39;t get the dev container way to work, you can refer to the <a href=\"https://github.com/simon-nystrom/node-mongodb-crud-api\">repository for this blog post</a>.</p>\n<p>The first course of action is to initialize a project in a new folder using <code>npm</code>, in your terminal run the following and complete the project setup:</p>\n<pre><code class=\"language-bash\">mkdir my-crud-api\n<span class=\"hljs-built_in\">cd</span> my-crud-api\nnpm init</code></pre>\n<p>Some basic dependencies are needed to create the API:</p>\n<pre><code class=\"language-bash\">npm install mongoose body-parser express@^5.0.0-alpha.8</code></pre>\n<ul>\n<li><code>mongoose</code> will be used to connect to MongoDB easily and create a schema for the Todo item.</li>\n<li><code>body-parser</code> will be used to enable parsing JSON requests easily.</li>\n<li><code>express</code> will be used to set up the HTTP server, we&#39;ll use the alpha version for 5.0 to simplify our code a little bit.</li>\n</ul>\n<hr>\n<h1 id=\"setting-up-the-web-server\">Setting up the web server</h1>\n<p>Begin by creating a file called <code>index.js</code>. This will be the entry point to our application and it is in this file that we will start and initialize our web server.</p>\n<pre><code class=\"language-javascript\"><span class=\"hljs-comment\">// index.js</span>\n<span class=\"hljs-keyword\">const</span> express = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&quot;express&quot;</span>);\n\n<span class=\"hljs-keyword\">const</span> app = express();\n\n<span class=\"hljs-comment\">// Wrap our starting logic in an async function so we can use await syntax</span>\n<span class=\"hljs-keyword\">const</span> startApplication = <span class=\"hljs-keyword\">async</span> () =&gt; {\n  <span class=\"hljs-keyword\">await</span> app.listen(<span class=\"hljs-number\">8000</span>);\n  <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">&quot;Listening on 8000...&quot;</span>);\n};\n\nstartApplication();</code></pre>\n<p>Now if you run <code>node index.js</code> in your terminal, your web server should be running and listening on port <code>8000</code>, you can verify that by going to <a href=\"http://localhost:8000\">http://localhost:8000</a> and you should be greeted with the string <code>Cannot GET /</code>. That means your server is working, albeit quite meaningless for now.</p>\n<hr>\n<h1 id=\"creating-the-todo-model-and-router\">Creating the Todo model and router</h1>\n<p>Create a new folder in the root directory of your project and call it <code>src</code>, inside this new folder create two files called <code>todo.js</code> and <code>todoRouter.js</code>.</p>\n<p>We&#39;ll place our model in the <code>todo.js</code> file. This will be the schema defined with help of <code>Mongoose</code> that we installed earlier.</p>\n<pre><code class=\"language-javascript\"><span class=\"hljs-comment\">// src/todo.js</span>\n<span class=\"hljs-keyword\">const</span> mongoose = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&quot;mongoose&quot;</span>);\n\n<span class=\"hljs-comment\">// Create a mongoose schema, make title and createdAt be the properties and make them required</span>\n<span class=\"hljs-keyword\">const</span> todoSchema = <span class=\"hljs-keyword\">new</span> mongoose.Schema({\n  <span class=\"hljs-attr\">title</span>: { <span class=\"hljs-attr\">type</span>: <span class=\"hljs-built_in\">String</span>, <span class=\"hljs-attr\">required</span>: <span class=\"hljs-literal\">true</span> },\n  <span class=\"hljs-attr\">createdAt</span>: { <span class=\"hljs-attr\">type</span>: <span class=\"hljs-built_in\">Date</span>, <span class=\"hljs-attr\">required</span>: <span class=\"hljs-literal\">true</span> },\n});\n\n<span class=\"hljs-keyword\">const</span> Todo = mongoose.model(<span class=\"hljs-string\">&quot;Todo&quot;</span>, todoSchema);\n\n<span class=\"hljs-built_in\">module</span>.exports = Todo;</code></pre>\n<p>This <code>Todo</code> object that we export from <code>src/todo.js</code> is the object that we will use to handle the database connections needed to interact with the database and create, read, update and delete todos. Let&#39;s use it in our router and define routes for all the actions we want to support:</p>\n<pre><code class=\"language-javascript\"><span class=\"hljs-comment\">// src/todoRouter.js</span>\n<span class=\"hljs-keyword\">const</span> express = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&quot;express&quot;</span>);\n<span class=\"hljs-keyword\">const</span> Todo = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&quot;./todo&quot;</span>);\n\n<span class=\"hljs-keyword\">const</span> todoRouter = express.Router();\n\n<span class=\"hljs-comment\">// List all todos</span>\ntodoRouter.get(<span class=\"hljs-string\">&quot;/&quot;</span>, <span class=\"hljs-keyword\">async</span> (_, res) =&gt; {\n  res.json(<span class=\"hljs-keyword\">await</span> Todo.find({}));\n});\n\n<span class=\"hljs-comment\">// Read todo by ID</span>\ntodoRouter.get(<span class=\"hljs-string\">&quot;/:todoId&quot;</span>, <span class=\"hljs-keyword\">async</span> (req, res) =&gt; {\n  <span class=\"hljs-keyword\">const</span> { todoId } = req.params;\n  res.json(<span class=\"hljs-keyword\">await</span> Todo.findById({ <span class=\"hljs-attr\">_id</span>: todoId }));\n});\n\n<span class=\"hljs-comment\">// Delete todo by ID</span>\ntodoRouter.delete(<span class=\"hljs-string\">&quot;/:todoId&quot;</span>, <span class=\"hljs-keyword\">async</span> (req, res) =&gt; {\n  <span class=\"hljs-keyword\">const</span> { todoId } = req.params;\n  <span class=\"hljs-keyword\">await</span> Todo.deleteOne({ <span class=\"hljs-attr\">_id</span>: todoId });\n  res.status(<span class=\"hljs-number\">204</span>).send();\n});\n\n<span class=\"hljs-comment\">// Update todo by ID</span>\ntodoRouter.put(<span class=\"hljs-string\">&quot;/:todoId&quot;</span>, <span class=\"hljs-keyword\">async</span> (req, res) =&gt; {\n  <span class=\"hljs-keyword\">const</span> { title } = req.body;\n  <span class=\"hljs-keyword\">const</span> { todoId } = req.params;\n  res.json(<span class=\"hljs-keyword\">await</span> Todo.updateOne({ <span class=\"hljs-attr\">_id</span>: todoId }, { title }));\n});\n\n<span class=\"hljs-comment\">// Create a todo</span>\ntodoRouter.post(<span class=\"hljs-string\">&quot;/&quot;</span>, <span class=\"hljs-keyword\">async</span> (req, res) =&gt; {\n  <span class=\"hljs-keyword\">const</span> { title } = req.body;\n  res.json(<span class=\"hljs-keyword\">await</span> Todo.create({ title, <span class=\"hljs-attr\">createdAt</span>: <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Date</span>() }));\n});\n\n<span class=\"hljs-built_in\">module</span>.exports = todoRouter;</code></pre>\n<hr>\n<h1 id=\"using-the-router-in-our-server\">Using the router in our server</h1>\n<p>Once the two files in the previous example have been created, it&#39;s time to hook the router up to our app and to connect to MongoDB using <code>mongoose</code>:</p>\n<pre><code class=\"language-javascript\"><span class=\"hljs-comment\">// index.js</span>\n<span class=\"hljs-keyword\">const</span> bodyParser = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&quot;body-parser&quot;</span>);\n<span class=\"hljs-keyword\">const</span> express = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&quot;express&quot;</span>);\n<span class=\"hljs-keyword\">const</span> mongoose = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&quot;mongoose&quot;</span>);\n<span class=\"hljs-keyword\">const</span> todoRouter = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&quot;./src/todoRouter&quot;</span>);\n\n<span class=\"hljs-keyword\">const</span> app = express();\n\n<span class=\"hljs-comment\">// Add body-parser middleware to automatically parse JSON requests</span>\napp.use(bodyParser.json());\n<span class=\"hljs-comment\">// Requests done to the base path /todo should go through the todoRouter</span>\napp.use(<span class=\"hljs-string\">&quot;/todo&quot;</span>, todoRouter);\n\n<span class=\"hljs-keyword\">const</span> startApplication = <span class=\"hljs-keyword\">async</span> () =&gt; {\n  <span class=\"hljs-keyword\">await</span> mongoose.connect(<span class=\"hljs-string\">&quot;mongodb://localhost:27017/todo&quot;</span>, {\n    <span class=\"hljs-attr\">useNewUrlParser</span>: <span class=\"hljs-literal\">true</span>,\n    <span class=\"hljs-attr\">useUnifiedTopology</span>: <span class=\"hljs-literal\">true</span>,\n  });\n  <span class=\"hljs-built_in\">console</span>.log(\n    <span class=\"hljs-string\">&quot;Successfully connected to MongoDB at: mongodb://localhost:27017/todo&quot;</span>\n  );\n  <span class=\"hljs-keyword\">await</span> app.listen(<span class=\"hljs-number\">8000</span>);\n  <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">&quot;Listening on 8000...&quot;</span>);\n};\n\nstartApplication();</code></pre>\n<hr>\n<h1 id=\"sending-some-requests\">Sending some requests</h1>\n<p>Once the <code>index.js</code> file has been extended with the additional functionalities above, you can restart your server and we are ready to send some requests using our terminal (you can of course use Postman or Insomnia or other ways of sending requests too):</p>\n<h3 id=\"create-a-todo-note-the-_id\">Create a todo (note the _id):</h3>\n<pre><code class=\"language-bash\">curl -XPOST -H<span class=\"hljs-string\">&#x27;Content-Type:application/json&#x27;</span> -d<span class=\"hljs-string\">&#x27;{&quot;title&quot;: &quot;My first todo!&quot;}&#x27;</span> localhost:8000/todo</code></pre>\n<h3 id=\"update-the-todo-use-the-_id-from-above\">Update the todo (use the _id from above):</h3>\n<pre><code class=\"language-bash\">curl -XPUT -H<span class=\"hljs-string\">&#x27;Content-Type:application/json&#x27;</span> -d<span class=\"hljs-string\">&#x27;{&quot;title&quot;: &quot;My first todo! But updated!&quot;}&#x27;</span> localhost:8000/todo/5f8f221fdb30b30457e23e1c</code></pre>\n<h3 id=\"read-the-todo-use-the-_id-from-above\">Read the todo (use the _id from above):</h3>\n<pre><code class=\"language-bash\">curl -XPUT -H<span class=\"hljs-string\">&#x27;Content-Type:application/json&#x27;</span> -d<span class=\"hljs-string\">&#x27;{&quot;title&quot;: &quot;My first todo! But updated!&quot;}&#x27;</span> localhost:8000/todo/5f8f221fdb30b30457e23e1c</code></pre>\n<h3 id=\"delete-the-todo-use-the-_id-from-above\">Delete the todo (use the _id from above):</h3>\n<pre><code class=\"language-bash\">curl -XDELETE localhost:8000/todo/5f8f221fdb30b30457e23e1c</code></pre>\n<h3 id=\"list-all-todos\">List all todos:</h3>\n<pre><code class=\"language-bash\">curl -H<span class=\"hljs-string\">&#x27;Content-Type:application/json&#x27;</span> localhost:8000/todo</code></pre>\n<hr>\n<p>I hope you learned something. Creating a basic API using the method above is quick and easy if you want to get a prototype up and running fast.</p>\n<p>Enjoy!</p>\n","date":"2020-10-20","slug":"crud-api-node-mongodb","title":"Create a CRUD API with Node.js and MongoDB","categories":[],"tags":["node","mongodb","express","javascript","mongoose"],"summary":"Learn how to create a CRUD API using Node.js, MongoDB and Express."}