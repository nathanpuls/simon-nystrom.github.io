{"pageProps":{"post":{"html":"<p>Sometimes you want to access data on the web that isn&#39;t easily available through an API. For that, web scraping is a viable alternative. Web scraping is in essence a way to programmatically visit a web site as if you were a browser and fetch the data that way. This tutorial post will guide you through the process of web scraping using Python3, and two libraries <a href=\"https://www.crummy.com/software/BeautifulSoup/bs4/doc/\">BeautifulSoup</a> and <a href=\"https://requests.readthedocs.io/en/master/\">Requests</a>. As an example, we will build a command line application to search and print ratings for movies and TV shows on IMDB.</p>\n<hr>\n<h1 id=\"project-setup\">Project setup</h1>\n<p>To follow along with the tutorial you will need to have the following:</p>\n<ul>\n<li><a href=\"https://www.python.org/downloads/\">Python</a> installed</li>\n<li>Some basic knowledge of Python and some basic HTML/CSS knowledge</li>\n</ul>\n<p>Alternatively you can check out <a href=\"https://newcurrent.se/blog/containerized-development-environment\">my blog post for using dev containers</a> and follow that guide but select the <code>Python 3</code> container spec when creating the dev container. If you can&#39;t get the dev container way to work, you can refer to the <a href=\"https://github.com/simon-nystrom/simple-web-scrape\">repository for this blog post</a>.</p>\n<p>Let&#39;s begin by creating a folder for our project and installing the required dependencies:</p>\n<pre><div class=\"copy-me\" onclick=\"copyCode(this)\">Copy</div><code>mkdir web-scrape\n<span class=\"hljs-built_in\">cd</span> web-scrape\npip3 install beautifulsoup4 requests</code></pre><ul>\n<li><code>beautifulsoup4</code> lets us easily access DOM elements programmatically</li>\n<li><code>requests</code> gives us a nice and easy to use interface to make HTTP requests</li>\n</ul>\n<hr>\n<h1 id=\"researching-the-applications-lifecycle\">Researching the application&#39;s lifecycle</h1>\n<p>As stated in the introduction, we&#39;re going to focus on searching on IMDB showing the rating for some selected title. Our first step should be to do these steps in a browser and see what it looks like there.</p>\n<p>Visit <a href=\"http://www.imdb.com\">www.imdb.com</a> in your browser and search for a movie of your choice. I searched for <em>Jurassic Park</em>, you should be greeted with something like the following image:</p>\n<p><img src=\"/images/imdb/jurassic_park_search_res.png\" alt=\"Jurassic Park search result on IMDB\"></p>\n<p>Once you&#39;re on this page, inspect one of the rows in the <em>&quot;Titles&quot;</em> table by right clicking and pressing <em>&quot;Inspect element&quot;</em>, this varies from browser to browser but in Firefox it looks like this:</p>\n<p><img src=\"/images/imdb/inspect_element.png\" alt=\"Inspect element\"></p>\n<p>You might also have noticed that something opened up at the bottom of your browser, that section is commonly referred to as the dev tools. We&#39;ll be using that now to figure out the structure of the data that we&#39;re after. At the time of writing this, it looks like this:</p>\n<p><img src=\"/images/imdb/dev_tools.png\" alt=\"Dev tools open\"></p>\n<p>What&#39;s displayed here is the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model/Introduction\">DOM</a> structure. The highlighted row here is what I selected when taking the <em>&quot;Inspect element&quot;</em> action earlier. This shows us how all the HTML nodes relate to each other and where in the DOM the data we&#39;re after is located. Since we want to be able to list these results in our application, we need to be able to present these search results.</p>\n<p>We can see that the data we&#39;re interested in is located inside the <code>&lt;td&gt;</code> element with the class <code>result_text</code>, the name of the title is wrapped in an <code>&lt;a&gt;</code> element with the <code>href</code> holding the relative link to the title. This is all the data we need from this page.</p>\n<p>Let&#39;s follow the link to this title to see what the next page we need to tackle looks like, click the link to one of the search results and you should end up on the page for the movie/show you picked:</p>\n<p><img src=\"/images/imdb/jurassic_park.png\" alt=\"Jurassic park\"></p>\n<p>When on this page, let&#39;s repeat the step and <em>&quot;Inspect element&quot;</em> on the rating display:</p>\n<p><img src=\"/images/imdb/inspect_element_2.png\" alt=\"Inspect rating element\">\n<img src=\"/images/imdb/dev_tools_2.png\" alt=\"Dev tools on inspect rating element\"></p>\n<p>Here we can see that for this page the data we&#39;re interested in is located inside a <code>span</code> element wrapped by a <code>strong</code> element that is in turn wrapped by a <code>div</code> element with the class <code>ratingValue</code>.</p>\n<p>Now that we have gathered all the information we need for our app, let&#39;s proceed to the coding part.</p>\n<hr>\n<h1 id=\"searching-on-imdb-and-listing-the-titles\">Searching on IMDB and listing the titles</h1>\n<p>Create a file <code>scrape.py</code>, this will be our only file for this project. In it we will begin by importing the required dependencies and adding search functionality:</p>\n<pre><div class=\"copy-me\" onclick=\"copyCode(this)\">Copy</div><code><span class=\"hljs-comment\"># scrape.py</span>\n<span class=\"hljs-keyword\">import</span> requests\n<span class=\"hljs-keyword\">from</span> bs4 <span class=\"hljs-keyword\">import</span> BeautifulSoup\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">search</span>(<span class=\"hljs-params\">search_term</span>):</span>\n    <span class=\"hljs-comment\"># Make the search request to IMDB</span>\n    response = requests.get(<span class=\"hljs-string\">f&quot;https://www.imdb.com/find?q=<span class=\"hljs-subst\">{search_term}</span>&quot;</span>)\n    html = response.text\n    soup = BeautifulSoup(html, <span class=\"hljs-string\">&quot;html.parser&quot;</span>)\n    <span class=\"hljs-comment\"># Find the table with the class findList</span>\n    table = soup.find(<span class=\"hljs-string\">&quot;table&quot;</span>, {<span class=\"hljs-string\">&quot;class&quot;</span>: <span class=\"hljs-string\">&quot;findList&quot;</span>})\n    <span class=\"hljs-comment\"># Use CSS selector syntax to get all td elements from the table with the class result_text</span>\n    rows = table.select(<span class=\"hljs-string\">&quot;tr td.result_text&quot;</span>)\n    <span class=\"hljs-comment\"># Construct a list with the search results, store the title and the href in dicts</span>\n    <span class=\"hljs-keyword\">return</span> [{<span class=\"hljs-string\">&quot;title&quot;</span>: row.get_text().strip(), <span class=\"hljs-string\">&quot;href&quot;</span>: row.a[<span class=\"hljs-string\">&#x27;href&#x27;</span>]} <span class=\"hljs-keyword\">for</span> row <span class=\"hljs-keyword\">in</span> rows]</code></pre><p>Let&#39;s add another function to this file where we&#39;ll place our user interaction code:</p>\n<pre><div class=\"copy-me\" onclick=\"copyCode(this)\">Copy</div><code><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">run</span>():</span>\n    search_term = <span class=\"hljs-built_in\">input</span>(<span class=\"hljs-string\">&quot;Search IMDB: &quot;</span>)\n    results = search(search_term)\n    num_results = <span class=\"hljs-built_in\">len</span>(results)\n    print(<span class=\"hljs-string\">f&quot;Found <span class=\"hljs-subst\">{num_results}</span> results:&quot;</span>)\n    <span class=\"hljs-comment\"># Use built-in function enumerate to access the index variable i</span>\n    <span class=\"hljs-keyword\">for</span> i, result <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">enumerate</span>(results):\n        print(<span class=\"hljs-string\">f&quot;(<span class=\"hljs-subst\">{i+<span class=\"hljs-number\">1</span>}</span>) <span class=\"hljs-subst\">{result[<span class=\"hljs-string\">&#x27;title&#x27;</span>]}</span>&quot;</span>)\n\n<span class=\"hljs-comment\"># Don&#x27;t forget this line! We have to call the run function or nothing will happen when we run our program.</span>\nrun()</code></pre><p>Save the file and we&#39;re ready to try our app to see what it looks like right now, run it by going to the terminal and running:</p>\n<pre><div class=\"copy-me\" onclick=\"copyCode(this)\">Copy</div><code>python3 scrape.py</code></pre><p>Enter a search term and something similar should show up:</p>\n<p><img src=\"/images/imdb/in_app_search_res.png\" alt=\"in app search results\"></p>\n<p>You might notice that selecting a result does nothing at the moment, and that&#39;s cause we only implemented half the logic. It&#39;s always good to test that what you&#39;ve got so far is working at least, and if you&#39;re seeing search results in your terminal then you&#39;re good to continue.</p>\n<hr>\n<h1 id=\"printing-the-rating-for-the-selected-title\">Printing the rating for the selected title</h1>\n<p>We need some more logic to request the next page and print the value from the <code>span</code> element we identified earlier. You may have noticed that in the <code>search</code> function we defined, we&#39;re returning the <code>href</code>s but we&#39;re yet to use them. Let&#39;s incorporate them now.</p>\n<p>In <code>scrape.py</code>, add another function:</p>\n<pre><div class=\"copy-me\" onclick=\"copyCode(this)\">Copy</div><code><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">get_rating</span>(<span class=\"hljs-params\">href</span>):</span>\n    <span class=\"hljs-comment\"># href passed in here should be from what we found earlier, the href from the &lt;a&gt; tag that the title was wrapped in</span>\n    response = requests.get(<span class=\"hljs-string\">f&quot;https://www.imdb.com<span class=\"hljs-subst\">{href}</span>&quot;</span>)\n    html = response.text\n    soup = BeautifulSoup(html, <span class=\"hljs-string\">&quot;html.parser&quot;</span>)\n    <span class=\"hljs-comment\"># Select by CSS selector for .ratingValue class and get the first result (index 0), we only expect there to be one</span>\n    rating = soup.select(<span class=\"hljs-string\">&quot;.ratingValue&quot;</span>)[<span class=\"hljs-number\">0</span>].span.get_text()\n    <span class=\"hljs-keyword\">return</span> rating</code></pre><p>And let&#39;s use it in our <code>run</code> function:</p>\n<pre><div class=\"copy-me\" onclick=\"copyCode(this)\">Copy</div><code><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">run</span>():</span>\n    <span class=\"hljs-comment\"># Main interaction</span>\n    search_term = <span class=\"hljs-built_in\">input</span>(<span class=\"hljs-string\">&quot;Search IMDB: &quot;</span>)\n    results = search(search_term)\n    num_results = <span class=\"hljs-built_in\">len</span>(results)\n\n    print(<span class=\"hljs-string\">f&quot;Found <span class=\"hljs-subst\">{num_results}</span> results:&quot;</span>)\n    <span class=\"hljs-keyword\">for</span> i, result <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">enumerate</span>(results):\n        print(<span class=\"hljs-string\">f&quot;(<span class=\"hljs-subst\">{i+<span class=\"hljs-number\">1</span>}</span>) <span class=\"hljs-subst\">{result[<span class=\"hljs-string\">&#x27;title&#x27;</span>]}</span>&quot;</span>)\n\n    <span class=\"hljs-comment\"># Convert to int and subtract one to undo the addition to the index in the above loop</span>\n    selection = <span class=\"hljs-built_in\">int</span>(<span class=\"hljs-built_in\">input</span>(<span class=\"hljs-string\">f&quot;Select by entering a number (1-<span class=\"hljs-subst\">{num_results}</span>): &quot;</span>)) - <span class=\"hljs-number\">1</span>\n    selected_result = results[selection]\n    <span class=\"hljs-comment\"># Pass in the href to the title we want to get the rating for</span>\n    rating = get_rating(selected_result[<span class=\"hljs-string\">&quot;href&quot;</span>])\n\n    print(<span class=\"hljs-string\">f&quot;<span class=\"hljs-subst\">{selected_result[<span class=\"hljs-string\">&#x27;title&#x27;</span>]}</span> has a rating of <span class=\"hljs-subst\">{rating}</span>!&quot;</span>)\n\n<span class=\"hljs-comment\"># Again, make sure you call this in scrape.py</span>\nrun()</code></pre><p>Running our app now results in the following behavior:</p>\n<p><img src=\"/images/imdb/final.png\" alt=\"Final output\"></p>\n<hr>\n<h1 id=\"summary\">Summary</h1>\n<p>If you can use an API to get ahold of the data that you&#39;re after, you should always do so, it&#39;s faster and less prone to errors. Scraping the web can get messy sometimes depending on the structure of the DOM. As you may have already figured out, if something was to change on the layout of IMDB, it would potentially break our app.</p>\n<p>I hope you learned something new and that you find the information provided here useful, maybe you were looking to use data from some site in your own project? Go ahead and try it out 😊.</p>\n<p>Feel free to ask any questions.</p>\n<p>Enjoy! <a href=\"https://github.com/simon-nystrom/simple-web-scrape\">Here</a> is the associated repository for this post.</p>\n","date":"2020-11-01","title":"Web scraping with Python","slug":"web-scraping-python","summary":"Learn how to scrape web sites to access information programmatically using Python3, BeautifulSoup and Requests.","categories":[],"published":true,"tags":["python","web-scraping","requests","tutorial","beautifulsoup"]}},"__N_SSG":true}